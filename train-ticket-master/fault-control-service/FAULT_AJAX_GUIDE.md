# 故障控制AJAX实时刷新功能说明

## 功能概述

故障控制中心现已支持使用AJAX技术实现实时状态刷新，无需刷新页面即可看到服务状态和故障控制状态的实时变化。

## 主要特性

### 1. 自动实时更新
- **状态更新频率**: 每5秒自动更新一次服务状态
- **时间更新频率**: 每1秒自动更新一次当前时间
- **无需手动刷新**: 页面会自动获取最新数据并更新显示

### 2. 智能状态管理
- **服务状态监控**: 实时监控服务在线/离线状态
- **故障控制状态**: 实时更新故障启用/禁用状态
- **参数变化检测**: 实时显示故障参数变化
- **连接状态监控**: 实时监控服务连接状态

### 3. 用户体验优化
- **保持操作状态**: 更新时不会影响用户正在进行的操作
- **无闪烁更新**: 平滑的状态更新，无页面闪烁
- **智能错误处理**: 网络请求失败时不影响页面功能
- **资源优化**: 页面卸载时自动清理定时器

## 技术实现

### 前端实现
```javascript
// 状态轮询间隔
const STATUS_INTERVAL = 5000; // 5秒

// 时间更新间隔
const TIME_INTERVAL = 1000; // 1秒

// 刷新服务状态
function refreshStatus() {
    fetch('/api/status')
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            updateStatusOverview(data);
            updateServiceList(data);
        }
    });
}

// 开始状态轮询
function startStatusPolling() {
    statusInterval = setInterval(refreshStatus, STATUS_INTERVAL);
}
```

### 后端支持
- 现有的`/api/status`接口提供JSON格式的服务状态
- 支持实时查询所有服务的故障控制状态
- 返回包含服务列表和故障状态的完整数据

## 使用方法

### 1. 访问故障控制页面
```
http://localhost:8090/
```

### 2. 自动状态更新
- 页面加载后自动开始状态轮询
- 每5秒自动更新服务状态
- 每1秒更新当前时间显示

### 3. 手动刷新
- 点击"刷新状态"按钮可立即刷新
- 点击右下角圆形刷新按钮也可立即刷新

## 监控内容

### 1. 服务状态概览
- **总服务数**: 自动统计所有服务数量
- **在线服务**: 实时统计在线服务数量
- **离线服务**: 实时统计离线服务数量
- **最后更新**: 显示当前时间

### 2. 服务详细状态
- **服务名称**: 显示服务标识
- **连接状态**: 在线/离线状态
- **故障控制**: 支持的故障类型
- **故障状态**: 启用/禁用状态
- **故障参数**: 延迟、错误码、概率等

### 3. 故障控制操作
- **启用故障**: 启用指定的故障类型
- **禁用故障**: 禁用指定的故障类型
- **参数调整**: 实时调整故障参数
- **状态反馈**: 操作后的状态反馈

## 性能优化

### 1. 轮询控制
- 只在页面激活时进行轮询
- 页面隐藏时暂停轮询
- 页面卸载时清理资源

### 2. 网络优化
- 使用轻量级的JSON数据格式
- 避免不必要的数据传输
- 智能错误重试机制

### 3. 内存管理
- 使用`clearInterval`清理定时器
- 防止内存泄漏
- 优化DOM操作

## 浏览器兼容性

- **现代浏览器**: Chrome, Firefox, Safari, Edge
- **移动端**: 支持响应式设计
- **JavaScript**: ES6+语法，需要现代浏览器支持

## 测试验证

### 手动测试
1. 启动控制服务: `./deploy.sh`
2. 访问故障控制页面: `http://localhost:8090/`
3. 观察状态是否每5秒自动更新
4. 测试手动刷新功能

### 自动化测试
```bash
# 运行故障控制AJAX测试
./test-fault-ajax.sh

# 运行演示脚本
./demo-fault-ajax.sh
```

## 故障排除

### 1. 状态不更新
- 检查浏览器控制台是否有错误
- 确认网络连接正常
- 验证后端服务状态

### 2. 页面卡顿
- 检查是否有大量服务
- 考虑调整轮询频率
- 检查浏览器性能

### 3. 内存使用过高
- 检查定时器是否正确清理
- 监控浏览器内存使用
- 必要时刷新页面

## 与压测功能的对比

| 功能 | 故障控制 | 压测控制 |
|------|----------|----------|
| 更新频率 | 5秒 | 1秒 |
| 更新内容 | 服务状态 | 日志内容 |
| 数据量 | 较小 | 较大 |
| 实时性 | 中等 | 高 |

## 未来改进

### 1. WebSocket支持
- 考虑使用WebSocket替代轮询
- 实现真正的实时通信
- 减少网络开销

### 2. 状态过滤
- 添加服务状态过滤
- 支持关键词搜索
- 提供状态导出功能

### 3. 性能监控
- 添加网络请求统计
- 监控页面性能指标
- 提供性能优化建议

## 总结

故障控制AJAX实时刷新功能提供了良好的用户体验，让用户能够实时监控服务状态和故障控制状态，无需手动刷新页面。该功能通过智能的轮询机制和资源管理，确保了系统的稳定性和性能。 